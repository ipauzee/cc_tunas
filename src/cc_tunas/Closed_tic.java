/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * Closed_tic.java
 *
 * Created on Mar 15, 2010, 1:04:46 PM
 */

package cc_tunas;

import javax.sun.database.JavaConnector;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import javax.swing.JOptionPane;
/**
 *
 * @author jsm
 */
public class Closed_tic extends javax.swing.JFrame {

    public static int conf=1;
    /** Creates new form Closed_tic */
    public Closed_tic() {
        initComponents();
    }

    private ContactCenterTunas CCanj;
    public Closed_tic(ContactCenterTunas ccanj){
        this();
        this.CCanj=ccanj;
    }
    private ticket Tic;
    public Closed_tic(ticket tic){
        this();
        this.Tic=tic;
    }
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel9 = new javax.swing.JPanel();
        ckconf = new javax.swing.JCheckBox();
        cbby = new javax.swing.JComboBox();
        jButton1 = new javax.swing.JButton();
        jButton2 = new javax.swing.JButton();
        jPanel3 = new javax.swing.JPanel();
        jScrollPane4 = new javax.swing.JScrollPane();
        txtsolution = new javax.swing.JTextArea();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("TICKET CLOSING");
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosed(java.awt.event.WindowEvent evt) {
                formWindowClosed(evt);
            }
        });

        jPanel9.setBackground(new java.awt.Color(255, 255, 255));
        jPanel9.setBorder(javax.swing.BorderFactory.createTitledBorder(""));
        jPanel9.setFont(new java.awt.Font("Calibri", 0, 11)); // NOI18N
        jPanel9.setLayout(null);

        ckconf.setBackground(new java.awt.Color(255, 255, 255));
        ckconf.setFont(new java.awt.Font("Calibri", 1, 12)); // NOI18N
        ckconf.setText("First Call Resolution");
        ckconf.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                ckconfActionPerformed(evt);
            }
        });
        jPanel9.add(ckconf);
        ckconf.setBounds(20, 20, 160, 24);

        cbby.setFont(new java.awt.Font("Calibri", 0, 12)); // NOI18N
        cbby.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Contact Center", "CSO" }));
        jPanel9.add(cbby);
        cbby.setBounds(290, 44, 120, 0);

        jButton1.setFont(new java.awt.Font("Calibri", 0, 12)); // NOI18N
        jButton1.setText("Closed Ticket");
        jButton1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jButton1MouseClicked(evt);
            }
        });
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });
        jPanel9.add(jButton1);
        jButton1.setBounds(10, 220, 105, 24);

        jButton2.setFont(new java.awt.Font("Calibri", 0, 12)); // NOI18N
        jButton2.setText("Cancel");
        jButton2.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jButton2MouseClicked(evt);
            }
        });
        jPanel9.add(jButton2);
        jButton2.setBounds(300, 220, 100, 24);

        jPanel3.setBackground(new java.awt.Color(255, 255, 255));
        jPanel3.setFont(new java.awt.Font("Calibri", 0, 11)); // NOI18N
        jPanel3.setLayout(null);

        txtsolution.setColumns(20);
        txtsolution.setFont(new java.awt.Font("Calibri", 0, 12)); // NOI18N
        txtsolution.setLineWrap(true);
        txtsolution.setRows(5);
        jScrollPane4.setViewportView(txtsolution);

        jPanel3.add(jScrollPane4);
        jScrollPane4.setBounds(10, 20, 380, 150);

        jPanel9.add(jPanel3);
        jPanel3.setBounds(10, 40, 400, 180);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel9, javax.swing.GroupLayout.PREFERRED_SIZE, 429, javax.swing.GroupLayout.PREFERRED_SIZE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel9, javax.swing.GroupLayout.PREFERRED_SIZE, 269, javax.swing.GroupLayout.PREFERRED_SIZE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jButton1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jButton1MouseClicked
        // TODO add your handling code here:
        if(ckconf.isSelected()==true){
            conf=1;
        }else{
            conf=0;
        }
        sql="update tickets set _status=4, close_date='"+opdt+"', close_time='"+optm+"', close_username='"+CCanj.lbluser.getText()+"', confirm="+conf+", confirm_by='"+cbby.getSelectedIndex()+"', solution='"+txtsolution.getText()+"' where ticket_id='"+Tic.id+"'";
        CCanj.jconn.SQLExecute(sql,CCanj.conn);
        sql1="insert into log_mail (mail_from,mail_to,mail_subject,mail_text,ticket_id,direction,username) values ('contact@anjrent.com','"+Tic.txtcsomail.getText()+"','<notify>#"+Tic.txtcusnam.getText()+"#"+Tic.cbnoplat.getSelectedItem()+"#"+Tic.txtusr.getText()+"#"+Tic.cbcategory.getSelectedItem()+"#"+Tic.txtnotic.getText()+"','CLOSED by : "+CCanj.lbluser.getText()+"\n"+opdt+"\n"+optm+"\n\nDetails :\n"+Tic.txtdetails.getText()+"\n\nSoluiton :\n"+Tic.txtlastnote.getText()+"','"+Tic.id+"',1,'"+CCanj.lbluser.getText()+")";
        CCanj.jconn.SQLExecute(sql1,CCanj.conn);
        JOptionPane.showMessageDialog(null, "TICKET HAS BEEN CLOSED", "TICKETING",JOptionPane.WARNING_MESSAGE);
    }//GEN-LAST:event_jButton1MouseClicked

    private void jButton2MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jButton2MouseClicked
        // TODO add your handling code here:
        dispose();
    }//GEN-LAST:event_jButton2MouseClicked

    private void formWindowClosed(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosed
        // TODO add your handling code here:
//        try {
//            conn.close();
//        } catch (SQLException ex) {
//            System.err.println(ex.getMessage());
//        }
    }//GEN-LAST:event_formWindowClosed

    private void ckconfActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_ckconfActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ckconfActionPerformed

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jButton1ActionPerformed

    /**
    * @param args the command line arguments
    */
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new Closed_tic().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JComboBox cbby;
    private javax.swing.JCheckBox ckconf;
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel9;
    private javax.swing.JScrollPane jScrollPane4;
    public static javax.swing.JTextArea txtsolution;
    // End of variables declaration//GEN-END:variables

    public static String sql;
    public static String sql1;
    public static ResultSet rs;
    public static String opdt;
    public static String optm;

    private void opdt(){
          try{
              sql="select CURRENT_DATE";
              rs = CCanj.jconn.SQLExecuteRS(sql, CCanj.conn);
              while(rs.next()){
                  opdt=rs.getString(1);
              }
          }catch(Exception exc){
              System.err.println(exc.getMessage());
          }
    }

        private void optm(){
            try{
              sql="select CURRENT_TIME";
              rs = CCanj.jconn.SQLExecuteRS(sql, CCanj.conn);
              while(rs.next()){
                  optm=rs.getString(1);
              }
          }catch(Exception exc){
              System.err.println(exc.getMessage());
          }
        }
}
